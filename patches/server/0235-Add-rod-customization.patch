From 771776bfde643ee24ab572b03887f661eb4bdb28 Mon Sep 17 00:00:00 2001
From: halfmaster1 <ohpointfive@gmail.com>
Date: Mon, 10 Apr 2023 22:56:22 -0400
Subject: [PATCH] Add rod customization


diff --git a/src/main/java/net/minecraft/server/EntityFishingHook.java b/src/main/java/net/minecraft/server/EntityFishingHook.java
index 38025152..971aac05 100644
--- a/src/main/java/net/minecraft/server/EntityFishingHook.java
+++ b/src/main/java/net/minecraft/server/EntityFishingHook.java
@@ -8,6 +8,7 @@ import org.bukkit.craftbukkit.event.CraftEventFactory;
 import org.bukkit.entity.Player;
 import org.bukkit.entity.Fish;
 import org.bukkit.event.player.PlayerFishEvent;
+import org.github.paperspigot.PaperSpigotConfig;
 import org.github.paperspigot.event.entity.ProjectileCollideEvent;
 // CraftBukkit end
 
@@ -58,12 +59,13 @@ public class EntityFishingHook extends Entity {
         this.locY -= 0.10000000149011612D;
         this.locZ -= (double) (MathHelper.sin(this.yaw / 180.0F * 3.1415927F) * 0.16F);
         this.setPosition(this.locX, this.locY, this.locZ);
-        float f = 0.4F;
 
-        this.motX = (double) (-MathHelper.sin(this.yaw / 180.0F * 3.1415927F) * MathHelper.cos(this.pitch / 180.0F * 3.1415927F) * f);
-        this.motZ = (double) (MathHelper.cos(this.yaw / 180.0F * 3.1415927F) * MathHelper.cos(this.pitch / 180.0F * 3.1415927F) * f);
-        this.motY = (double) (-MathHelper.sin(this.pitch / 180.0F * 3.1415927F) * f);
-        this.c(this.motX, this.motY, this.motZ, 1.5F, 1.0F);
+        this.motX = (double) -MathHelper.sin(this.yaw / 180.0F * 3.1415927F) * MathHelper.cos(this.pitch / 180.0F * 3.1415927F);
+        this.motZ = (double) MathHelper.cos(this.yaw / 180.0F * 3.1415927F) * MathHelper.cos(this.pitch / 180.0F * 3.1415927F);
+        this.motY = (double) -MathHelper.sin(this.pitch / 180.0F * 3.1415927F);
+        float randomMultiplier = PaperSpigotConfig.includeRandomnessInBobberTrajectory ? 1.0F : 0.0F;
+        float speed = 1.5F * (float) PaperSpigotConfig.bobberSpeedMultiplier;
+        this.c(this.motX, this.motY, this.motZ, speed , randomMultiplier);
     }
 
     protected void h() {}
@@ -241,7 +243,7 @@ public class EntityFishingHook extends Entity {
 
                 this.pitch = this.lastPitch + (this.pitch - this.lastPitch) * 0.2F;
                 this.yaw = this.lastYaw + (this.yaw - this.lastYaw) * 0.2F;
-                float f2 = 0.92F;
+                float f2 = (float) Math.pow(0.92F, PaperSpigotConfig.bobberFrictionMultiplier);
 
                 if (this.onGround || this.positionChanged) {
                     f2 = 0.5F;
@@ -361,7 +363,7 @@ public class EntityFishingHook extends Entity {
                 }
 
                 d6 = d7 * 2.0D - 1.0D;
-                this.motY += 0.03999999910593033D * d6;
+                this.motY += 0.03999999910593033D * d6 * PaperSpigotConfig.bobberGravityMultiplier;
                 if (d7 > 0.0D) {
                     f2 = (float) ((double) f2 * 0.9D);
                     this.motY *= 0.8D;
@@ -421,7 +423,7 @@ public class EntityFishingHook extends Entity {
                     return 0;
                 }
                 // CraftBukkit end
-                
+
                 double d0 = this.owner.locX - this.locX;
                 double d1 = this.owner.locY - this.locY;
                 double d2 = this.owner.locZ - this.locZ;
diff --git a/src/main/java/org/github/paperspigot/PaperSpigotConfig.java b/src/main/java/org/github/paperspigot/PaperSpigotConfig.java
index acf32e1e..b6bb6886 100644
--- a/src/main/java/org/github/paperspigot/PaperSpigotConfig.java
+++ b/src/main/java/org/github/paperspigot/PaperSpigotConfig.java
@@ -213,6 +213,26 @@ public class PaperSpigotConfig
         extraArrowClientGravity = getDouble("settings.extra-arrow-client-gravity", extraArrowClientGravity);
     }
 
+    public static double bobberGravityMultiplier = 1.0D;
+    private static void bobberGravityMultiplier() {
+        bobberGravityMultiplier = getDouble("settings.bobber-gravity-multiplier", bobberGravityMultiplier);
+    }
+
+    public static double bobberSpeedMultiplier = 1.0D;
+    private static void bobberSpeedMultiplier() {
+        bobberSpeedMultiplier = getDouble("settings.bobber-speed-multiplier", bobberSpeedMultiplier);
+    }
+
+    public static double bobberFrictionMultiplier = 1.0D;
+    private static void bobberFrictionMultiplier() {
+        bobberFrictionMultiplier = getDouble("settings.bobber-friction-multiplier", bobberFrictionMultiplier);
+    }
+
+    public static boolean includeRandomnessInBobberTrajectory = false;
+    private static void includeRandomnessInBobberTrajectory() {
+        includeRandomnessInBobberTrajectory = getBoolean("settings.include-randomness-in-bobber-trajectory", includeRandomnessInBobberTrajectory);
+    }
+
     public static boolean tickEmptyWorlds = true;
     private static void tickEmptyWorlds() {
         tickEmptyWorlds = getBoolean("settings.tick-empty-worlds", tickEmptyWorlds);
-- 
2.29.2

